name: Backend CI/CD workflow

on:
  push:
    branches:
      - main
      - develop
    paths:
      - 'backend/**'

  pull_request:
    branches:
      - main
      - develop
    paths:
      - 'backend/**'

jobs:
          
  backend_deploy:
    runs-on: ubuntu-latest
    name: Build and Deploy Backend to AWS
    #needs: backend_test
    steps:
      - name: Checkout source code
        uses: actions/checkout@v4

      - name: Set the stack name
        id: set_stack_name
        run: |
          if [[ github.ref == 'refs/heads/develop' ]]; then
            echo "STACK_NAME=etron-dev" >> $GITHUB_ENV
          elif [[ github.ref == 'refs/heads/main' ]]; then
            echo "STACK_NAME=etron-prod" >> $GITHUB_ENV
          fi

      - name: Check STACK_NAME
        run: echo "STACK_NAME=${{ env.STACK_NAME }}"
